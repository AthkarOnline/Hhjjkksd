<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>أذكار المسلم - موقع أذكار احترافي</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore-compat.js"></script>
    <style>
        /* تم الحفاظ على جميع أنماط التصميم الأصلية */
        /* ... (جميع أنماط CSS الأصلية) ... */
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-container">
            <div class="logo">
                <i class="fas fa-pray"></i>
                <h1>أذكار المسلم</h1>
            </div>
            
            <nav>
                <button class="hamburger" id="hamburger">
                    <i class="fas fa-bars"></i>
                </button>
                <ul id="nav-menu">
                    <li><a href="#" class="nav-link active" data-section="home-section">الرئيسية</a></li>
                    <li><a href="#" class="nav-link" data-section="adhkar-section">الأذكار</a></li>
                    <li><a href="#" class="nav-link" data-section="rosary-section">المسبحة</a></li>
                    <li><a href="#" class="nav-link" data-section="prayer-section">أوقات الصلاة</a></li>
                    <li><a href="#" class="nav-link" data-section="user-section">حسابي</a></li>
                </ul>
            </nav>
            
            <div class="auth-buttons" id="auth-buttons">
                <button class="btn btn-outline" id="login-btn">
                    <i class="fas fa-sign-in-alt"></i> تسجيل الدخول
                </button>
                <button class="btn btn-primary" id="register-btn">
                    <i class="fas fa-user-plus"></i> إنشاء حساب
                </button>
            </div>
            
            <div class="user-profile" id="user-profile" style="display:none;">
                <div class="user-avatar" id="user-avatar">م</div>
                <div id="username">محمد</div>
                <button class="btn btn-outline" id="logout-btn">
                    <i class="fas fa-sign-out-alt"></i>
                </button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main id="main-content">
        <!-- Home Section -->
        <section class="hero section active" id="home-section">
            <!-- ... (نفس محتوى القسم الرئيسي) ... -->
        </section>
        
        <!-- Daily Inspiration -->
        <div class="container">
            <!-- ... (نفس محتوى وحي اليوم) ... -->
        </div>

        <!-- Adhkar Section -->
        <section class="adhkar-section section" id="adhkar-section">
            <!-- ... (نفس محتوى الأذكار) ... -->
        </section>

        <!-- Rosary Section -->
        <section class="rosary-section section" id="rosary-section">
            <!-- ... (نفس محتوى المسبحة) ... -->
        </section>

        <!-- Prayer Times Section -->
        <section class="prayer-section section" id="prayer-section">
            <!-- ... (نفس محتوى أوقات الصلاة) ... -->
        </section>
        
        <!-- User Section -->
        <section class="user-section section" id="user-section">
            <div class="back-button" data-section="home-section">
                <i class="fas fa-arrow-left"></i>
            </div>
            <div class="container">
                <div class="user-container">
                    <h2>حساب المستخدم</h2>
                    
                    <div class="auth-forms">
                        <div class="auth-form">
                            <h3>تسجيل الدخول</h3>
                            <div class="form-group">
                                <label for="login-email">البريد الإلكتروني</label>
                                <input type="email" id="login-email" placeholder="أدخل بريدك الإلكتروني">
                            </div>
                            <div class="form-group">
                                <label for="login-password">كلمة المرور</label>
                                <input type="password" id="login-password" placeholder="أدخل كلمة المرور">
                            </div>
                            <button class="btn btn-primary" id="login-form-btn">تسجيل الدخول</button>
                            <p style="margin-top: 1.5rem; text-align: center;">
                                <a href="#" id="forgot-password">نسيت كلمة المرور؟</a>
                            </p>
                        </div>
                        
                        <div class="auth-form">
                            <h3>إنشاء حساب جديد</h3>
                            <div class="form-group">
                                <label for="register-name">الاسم الكامل</label>
                                <input type="text" id="register-name" placeholder="أدخل اسمك الكامل">
                            </div>
                            <div class="form-group">
                                <label for="register-email">البريد الإلكتروني</label>
                                <input type="email" id="register-email" placeholder="أدخل بريدك الإلكتروني">
                            </div>
                            <div class="form-group">
                                <label for="register-password">كلمة المرور</label>
                                <input type="password" id="register-password" placeholder="أنشئ كلمة مرور قوية">
                            </div>
                            <button class="btn btn-primary" id="register-form-btn">إنشاء حساب</button>
                        </div>
                    </div>
                    
                    <div class="admin-section" id="admin-section">
                        <h3>لوحة التحكم للمشرف</h3>
                        <div class="admin-panel">
                            <h4>المستخدمون المسجلون</h4>
                            <table class="users-table">
                                <thead>
                                    <tr>
                                        <th>الاسم</th>
                                        <th>البريد الإلكتروني</th>
                                        <th>الدور</th>
                                    </tr>
                                </thead>
                                <tbody id="users-list">
                                    <!-- Users will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <!-- ... (نفس محتوى التذييل) ... -->
    </footer>

    <!-- Share Modal -->
    <div class="modal" id="share-modal">
        <!-- ... (نفس محتوى نافذة المشاركة) ... -->
    </div>

    <!-- Audio for Adhan - تم التعديل على الرابط -->
    <audio id="adhan-audio" preload="auto">
        <source src="https://www.islamcan.com/audio/adhan/azan1.mp3" type="audio/mpeg">
    </audio>

    <script>
        // ====== Firebase Configuration (v10) ======
        const firebaseConfig = {
            apiKey: "AIzaSyBNBDSL01Flqv7iLIiPenuQ-eDQ9_ZxQD4",
            authDomain: "athkar-almuslim-3b9bf.firebaseapp.com",
            databaseURL: "https://athkar-almuslim-3b9bf-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "athkar-almuslim-3b9bf",
            storageBucket: "athkar-almuslim-3b9bf.appspot.com",
            messagingSenderId: "1012115796818",
            appId: "1:1012115796818:web:108f7ce679c46b1681008b"
        };
        
        // Initialize Firebase v10
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // ====== Global Variables ======
        let currentCategory = 'morning';
        let rosaryCount = 0;
        let rosaryDhikr = 'سُبْحَانَ اللَّهِ';
        const prayerTimes = {
            amman: { fajr: "3:46 ص", sunrise: "5:31 ص", dhuhr: "12:40 م", asr: "4:22 م", maghrib: "7:49 م", isha: "9:19 م" },
            irbid: { fajr: "3:42 ص", sunrise: "5:28 ص", dhuhr: "12:36 م", asr: "4:18 م", maghrib: "7:45 م", isha: "9:15 م" },
            zarqa: { fajr: "3:44 ص", sunrise: "5:30 ص", dhuhr: "12:38 م", asr: "4:20 م", maghrib: "7:47 م", isha: "9:17 م" },
            mafraq: { fajr: "3:40 ص", sunrise: "5:26 ص", dhuhr: "12:34 م", asr: "4:16 م", maghrib: "7:43 م", isha: "9:13 م" },
            ajloun: { fajr: "3:43 ص", sunrise: "5:29 ص", dhuhr: "12:37 م", asr: "4:19 م", maghrib: "7:46 م", isha: "9:16 م" },
            jerash: { fajr: "3:44 ص", sunrise: "5:30 ص", dhuhr: "12:38 م", asr: "4:20 م", maghrib: "7:47 م", isha: "9:17 م" },
            maan: { fajr: "3:50 ص", sunrise: "5:36 ص", dhuhr: "12:44 م", asr: "4:26 م", maghrib: "7:53 م", isha: "9:23 م" },
            salt: { fajr: "3:45 ص", sunrise: "5:31 ص", dhuhr: "12:39 م", asr: "4:21 م", maghrib: "7:48 م", isha: "9:18 م" },
            tafilah: { fajr: "3:48 ص", sunrise: "5:34 ص", dhuhr: "12:42 م", asr: "4:24 م", maghrib: "7:51 م", isha: "9:21 م" },
            madaba: { fajr: "3:46 ص", sunrise: "5:32 ص", dhuhr: "12:40 م", asr: "4:22 م", maghrib: "7:49 م", isha: "9:19 م" },
            karak: { fajr: "3:47 ص", sunrise: "5:33 ص", dhuhr: "12:41 م", asr: "4:23 م", maghrib: "7:50 م", isha: "9:20 م" },
            aqaba: { fajr: "4:00 ص", sunrise: "5:46 ص", dhuhr: "12:54 م", asr: "4:36 م", maghrib: "8:03 م", isha: "9:33 م" }
        };

        // ====== Adhkar Data ======
        const adhkarData = {
            // ... (نفس بيانات الأذكار) ...
        };

        // ====== DOM Elements ======
        const adhkarContainer = document.getElementById('adhkar-container');
        const rosaryText = document.getElementById('rosary-text');
        const counterElement = document.getElementById('counter');
        const citySelect = document.getElementById('city-select');
        const sections = document.querySelectorAll('.section');
        const navLinks = document.querySelectorAll('.nav-link');
        const notificationBtn = document.getElementById('notification-btn');
        const adhanAudio = document.getElementById('adhan-audio');
        const shareModal = document.getElementById('share-modal');
        const closeShareModal = document.getElementById('close-share-modal');
        const usersList = document.getElementById('users-list');
        const adminSection = document.getElementById('admin-section');

        // ====== Functions ======
        function renderAdhkar(category) {
            // ... (نفس وظيفة عرض الأذكار) ...
        }

        function updatePrayerTimes(city) {
            // ... (نفس وظيفة تحديث أوقات الصلاة) ...
        }

        function showSection(sectionId) {
            // ... (نفس وظيفة عرض الأقسام) ...
        }

        function playAdhan() {
            adhanAudio.play();
        }

        // ====== Firebase Functions - تم التعديل ======
        function registerUser(email, password, name) {
            auth.createUserWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    db.collection("users").doc(user.uid).set({
                        name: name,
                        email: email,
                        role: "user"
                    })
                    .then(() => {
                        alert(`تم إنشاء حساب جديد للاسم: ${name}\nالبريد الإلكتروني: ${email}`);
                        document.getElementById('register-name').value = '';
                        document.getElementById('register-email').value = '';
                        document.getElementById('register-password').value = '';
                        
                        // تحديث واجهة المستخدم بعد التسجيل
                        document.getElementById('auth-buttons').style.display = 'none';
                        document.getElementById('user-profile').style.display = 'flex';
                        document.getElementById('username').textContent = name;
                        document.getElementById('user-avatar').textContent = name.charAt(0);
                    })
                    .catch((error) => {
                        console.error("Error adding user: ", error);
                        
                        // رسائل خطأ عربية
                        if (error.code === 'auth/email-already-in-use') {
                            alert('هذا البريد الإلكتروني مستخدم مسبقاً');
                        } else if (error.code === 'auth/weak-password') {
                            alert('كلمة المرور ضعيفة، يجب أن تكون 6 أحرف على الأقل');
                        } else {
                            alert("حدث خطأ أثناء تسجيل المستخدم");
                        }
                    });
                })
                .catch((error) => {
                    console.error("Error creating user: ", error);
                    
                    // رسائل خطأ عربية
                    if (error.code === 'auth/email-already-in-use') {
                        alert('هذا البريد الإلكتروني مستخدم مسبقاً');
                    } else if (error.code === 'auth/invalid-email') {
                        alert('البريد الإلكتروني غير صالح');
                    } else if (error.code === 'auth/weak-password') {
                        alert('كلمة المرور ضعيفة، يجب أن تكون 6 أحرف على الأقل');
                    } else {
                        alert("حدث خطأ أثناء إنشاء الحساب");
                    }
                });
        }

        function loginUser(email, password) {
            auth.signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    const user = userCredential.user;
                    db.collection("users").doc(user.uid).get()
                        .then((doc) => {
                            if (doc.exists) {
                                const userData = doc.data();
                                
                                // تحديث واجهة المستخدم
                                document.getElementById('auth-buttons').style.display = 'none';
                                document.getElementById('user-profile').style.display = 'flex';
                                document.getElementById('username').textContent = userData.name;
                                document.getElementById('user-avatar').textContent = userData.name.charAt(0);
                                
                                if (userData.role === "admin") {
                                    adminSection.style.display = 'block';
                                    loadUsers();
                                }
                                
                                alert('تم تسجيل الدخول بنجاح!');
                            }
                        })
                        .catch((error) => {
                            console.error("Error getting user data: ", error);
                            alert("حدث خطأ أثناء جلب بيانات المستخدم");
                        });
                })
                .catch((error) => {
                    console.error("Error signing in: ", error);
                    
                    // رسائل خطأ عربية
                    if (error.code === 'auth/user-not-found') {
                        alert('المستخدم غير موجود');
                    } else if (error.code === 'auth/wrong-password') {
                        alert('كلمة المرور غير صحيحة');
                    } else if (error.code === 'auth/invalid-email') {
                        alert('البريد الإلكتروني غير صالح');
                    } else {
                        alert("البريد الإلكتروني أو كلمة المرور غير صحيحة");
                    }
                });
        }

        function loadUsers() {
            db.collection("users").get()
                .then((querySnapshot) => {
                    usersList.innerHTML = '';
                    querySnapshot.forEach((doc) => {
                        const user = doc.data();
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${user.name}</td>
                            <td>${user.email}</td>
                            <td>${user.role}</td>
                        `;
                        usersList.appendChild(row);
                    });
                })
                .catch((error) => {
                    console.error("Error loading users: ", error);
                    alert("حدث خطأ أثناء تحميل المستخدمين");
                });
        }

        function logoutUser() {
            auth.signOut().then(() => {
                document.getElementById('auth-buttons').style.display = 'flex';
                document.getElementById('user-profile').style.display = 'none';
                adminSection.style.display = 'none';
                alert('تم تسجيل الخروج بنجاح');
            }).catch((error) => {
                console.error("Error signing out: ", error);
                alert("حدث خطأ أثناء تسجيل الخروج");
            });
        }

        // ====== Event Listeners ======
        document.addEventListener('DOMContentLoaded', function() {
            // Set current year
            document.getElementById('current-year').textContent = new Date().getFullYear();
            
            // Initialize adhkar
            renderAdhkar(currentCategory);
            
            // Set initial prayer times
            updatePrayerTimes('amman');
            
            // Mobile menu toggle
            document.getElementById('hamburger').addEventListener('click', () => {
                document.getElementById('nav-menu').classList.toggle('show');
            });
            
            // Navigation links
            navLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.dataset.section;
                    showSection(sectionId);
                });
            });
            
            // Footer links
            document.querySelectorAll('.footer-links a[data-section]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const sectionId = link.dataset.section;
                    showSection(sectionId);
                });
            });
            
            // Footer category links
            document.querySelectorAll('.footer-links a[data-category]').forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    showSection('adhkar-section');
                    currentCategory = link.dataset.category;
                    renderAdhkar(currentCategory);
                });
            });
            
            // Feature cards navigation
            document.querySelectorAll('.feature-card').forEach(card => {
                card.addEventListener('click', () => {
                    const sectionId = card.dataset.section;
                    showSection(sectionId);
                });
            });
            
            // Back buttons
            document.querySelectorAll('.back-button').forEach(btn => {
                btn.addEventListener('click', () => {
                    showSection(btn.dataset.section);
                });
            });
            
            // Category buttons
            document.querySelectorAll('.category-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentCategory = btn.dataset.category;
                    renderAdhkar(currentCategory);
                });
            });
            
            // Rosary functionality
            document.getElementById('count-btn').addEventListener('click', () => {
                rosaryCount++;
                counterElement.textContent = rosaryCount;
                
                if (rosaryCount % 33 === 0) {
                    if (rosaryDhikr === 'سُبْحَانَ اللَّهِ') {
                        rosaryDhikr = 'الْحَمْدُ لِلَّهِ';
                    } else if (rosaryDhikr === 'الْحَمْدُ لِلَّهِ') {
                        rosaryDhikr = 'اللَّهُ أَكْبَرُ';
                    } else {
                        rosaryDhikr = 'سُبْحَانَ اللَّهِ';
                    }
                    rosaryText.textContent = rosaryDhikr;
                }
                
                counterElement.style.transform = 'scale(1.1)';
                setTimeout(() => {
                    counterElement.style.transform = 'scale(1)';
                }, 300);
            });
            
            document.getElementById('reset-btn').addEventListener('click', () => {
                rosaryCount = 0;
                counterElement.textContent = rosaryCount;
                rosaryText.textContent = 'سُبْحَانَ اللَّهِ';
            });
            
            // Preset buttons
            document.querySelectorAll('.preset-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    rosaryCount = parseInt(btn.dataset.count);
                    counterElement.textContent = rosaryCount;
                    rosaryText.textContent = 'سُبْحَانَ اللَّهِ';
                });
            });
            
            // City selector
            citySelect.addEventListener('change', (e) => {
                updatePrayerTimes(e.target.value);
            });
            
            // Vibrate button
            document.getElementById('vibrate-btn').addEventListener('click', () => {
                if (navigator.vibrate) {
                    navigator.vibrate([200]);
                }
            });
            
            // Notification button
            notificationBtn.addEventListener('click', () => {
                alert('سيتم تفعيل التنبيهات في الإصدار القادم إن شاء الله');
            });
            
            // Play adhan button
            document.getElementById('sound-btn').addEventListener('click', playAdhan);
            
            // Close share modal
            closeShareModal.addEventListener('click', () => {
                shareModal.style.display = 'none';
            });
            
            // Close modal when clicking outside
            window.addEventListener('click', (e) => {
                if (e.target === shareModal) {
                    shareModal.style.display = 'none';
                }
            });
            
            // User login
            document.getElementById('login-form-btn').addEventListener('click', () => {
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                if(email && password) {
                    loginUser(email, password);
                } else {
                    alert('الرجاء ملء جميع الحقول');
                }
            });
            
            // User registration
            document.getElementById('register-form-btn').addEventListener('click', () => {
                const name = document.getElementById('register-name').value;
                const email = document.getElementById('register-email').value;
                const password = document.getElementById('register-password').value;
                if(name && email && password) {
                    registerUser(email, password, name);
                } else {
                    alert('الرجاء ملء جميع الحقول');
                }
            });
            
            // Logout
            document.getElementById('logout-btn').addEventListener('click', logoutUser);
            
            // Forgot password
            document.getElementById('forgot-password').addEventListener('click', (e) => {
                e.preventDefault();
                const email = prompt("الرجاء إدخال بريدك الإلكتروني لإعادة تعيين كلمة المرور:");
                if (email) {
                    auth.sendPasswordResetEmail(email)
                        .then(() => {
                            alert("تم إرسال رابط إعادة تعيين كلمة المرور إلى بريدك الإلكتروني");
                        })
                        .catch((error) => {
                            console.error("Error sending reset email: ", error);
                            alert("حدث خطأ أثناء إرسال رابط إعادة التعيين");
                        });
                }
            });
            
            // Check auth state
            auth.onAuthStateChanged((user) => {
                if (user) {
                    db.collection("users").doc(user.uid).get()
                        .then((doc) => {
                            if (doc.exists) {
                                const userData = doc.data();
                                document.getElementById('auth-buttons').style.display = 'none';
                                document.getElementById('user-profile').style.display = 'flex';
                                document.getElementById('username').textContent = userData.name;
                                document.getElementById('user-avatar').textContent = userData.name.charAt(0);
                                
                                if (userData.role === "admin") {
                                    adminSection.style.display = 'block';
                                    loadUsers();
                                }
                            }
                        });
                } else {
                    document.getElementById('auth-buttons').style.display = 'flex';
                    document.getElementById('user-profile').style.display = 'none';
                    adminSection.style.display = 'none';
                }
            });
        });
    </script>
</body>
</html>
